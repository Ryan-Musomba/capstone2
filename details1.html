<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Show Details</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link rel="stylesheet" href="detail1.css">
   
</head>
<body>
    <div class="navbar">
        <div class="navbar-container">
            <div class="logo-container"><h1 class="logo">MovieNet</h1></div>
            <div class="menu-container" >
                <ul class="menu-list" >
                  <li class="menu-list-item active"><a href="index1.html">Home</a></li>
                  <li class="menu-list-item"><a href="index2.html">Movies</a></li>
                  <li class="menu-list-item"><a href="tvshow.html">Tv-Shows</a></li>
                </ul>
              </div>
            <div class="profile-container">
                <i class=" profile-picture fa-solid fa-user"></i>
                <div class="profile-text-container">
                    <span class="profile-text">Profile</span>
                    <i class="fa-solid fa-caret-down"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="sidebar">
        <a href="index1.html"><i class="sidebar-icon fa-solid fa-house-chimney"></i></a> 
        <a href="index2.html"><i class="sidebar-icon fa-solid fa-film"></i></a> 
        <a href="tvshow.html"><i class="sidebar-icon fa-solid fa-tv"></i></a>
        <div class="sidebar-settings">
          <i class="fa-solid fa-gear" style="padding-bottom: 20px"></i>
          <i class="sidebar-icon fa-solid fa-user-group"></i>
        </div>
      </div>
    <div id="tvshow-container">
        <img id="tvshow-poster" src="" alt="TV Show Poster" />
        <div id="tvshow-details">
            <h2 id="tvshow-name"></h2>
            <p class="genre"></p>
            <p class="seasons"></p>
            <p class="age-rating"></p>
            <p class="description"></p>
            <a href="#" id="watch-trailer">Watch Now</a>
        </div>
    </div>
    <div id="trailer-section">
        <h3>Official Trailer</h3>
        <iframe
            id="trailer-video"
            src=""
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
        ></iframe>
    </div>
    <script>
        // Apply dark or light mode based on localStorage
        document.addEventListener("DOMContentLoaded", () => {
            const darkmode = localStorage.getItem("darkmode");

            if (darkmode === "enabled") {
                document.body.classList.add("darkmode");
                document.body.classList.remove("lightmode");
            } else {
                document.body.classList.remove("darkmode");
                document.body.classList.add("lightmode");
            }
        });

        const API_KEY = '3fd2be6f0c70a2a598f084ddfb75487c'; // Replace with your TMDb API key
        const IMG_PATH = 'https://image.tmdb.org/t/p/w1280';

        // Get the TV show ID from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const tvShowId = urlParams.get('id');

        // Fetch TV show details and videos
        async function fetchTVShowDetails(tvShowId) {
            const TV_SHOW_URL = `https://api.themoviedb.org/3/tv/${tvShowId}?api_key=${API_KEY}`;
            const VIDEO_URL = `https://api.themoviedb.org/3/tv/${tvShowId}/videos?api_key=${API_KEY}`;

            try {
                // Fetch TV show details
                const tvShowRes = await fetch(TV_SHOW_URL);
                const tvShowData = await tvShowRes.json();
                populateTVShowDetails(tvShowData);

                // Fetch TV show videos (trailers)
                const videoRes = await fetch(VIDEO_URL);
                const videoData = await videoRes.json();
                populateTrailer(videoData.results);
            } catch (error) {
                console.error('Error fetching TV show details:', error);
            }
        }

        // Populate the TV show details on the page
        function populateTVShowDetails(tvShow) {
            document.getElementById("tvshow-poster").src = `${IMG_PATH}${tvShow.poster_path}`;
            document.getElementById("tvshow-name").textContent = tvShow.name;
            document.querySelector(".genre").textContent = tvShow.genres
                .map(genre => genre.name)
                .join(", ");
            document.querySelector(".seasons").textContent = `${tvShow.number_of_seasons} Seasons`;
            document.querySelector(".age-rating").textContent = tvShow.adult ? "R" : "PG-13";
            document.querySelector(".description").textContent = tvShow.overview;
        }

        // Populate the trailer section with the first available trailer
        function populateTrailer(videos) {
            const trailerSection = document.getElementById("trailer-section");
            const trailerVideo = document.getElementById("trailer-video");

            // Find the first trailer (usually of type "Trailer")
            const trailer = videos.find(video => video.type === 'Trailer' && video.site === 'YouTube');

            if (trailer) {
                trailerVideo.src = `https://www.youtube.com/embed/${trailer.key}`;
            } else {
                trailerSection.innerHTML = '<h3>No trailer available</h3>';
            }
        }

        // Fetch and display TV show details and trailer
        if (tvShowId) {
            fetchTVShowDetails(tvShowId);
        } else {
            // Redirect back to the main page if no TV show ID is provided
            window.location.href = "index.html";
        }
    </script>
</body>
</html>